name: CI

on: push

jobs:
    ci:
        strategy:
            matrix:
                node:
                    - 14
                    - 16
                    - 17
                runner:
                    - ubuntu-latest
                    - macos-latest
                    - windows-latest

        name: Continuous Integration (${{ matrix.runner }} / Node ${{ matrix.node }})
        runs-on: ${{ matrix.runner }}
        timeout-minutes: 10
        steps:
            - name: Git Checkout
              uses: actions/checkout@v2
            - name: Setup pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: latest
                  run_install: |
                      - args: [--frozen-lockfile, --strict-peer-dependencies]
            - name: Setup Node
              uses: actions/setup-node@v2
              with:
                  node-version: ${{ matrix.node }}
                  cache: pnpm
            - name: Run Tests
              run: pnpm ci
              env:
                  ci: true
                  NODE_ENV: production
