// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

generator zod {
    provider = "zod-prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    /// The unique ID of the user
    uuid              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    /// The unique DID used by Magic for authentication
    did               String   @unique @db.VarChar(51) /// @zod.regex(/^did:ethr:0x[a-fA-F0-9]{40}$/, { message: "Invalide DID von Magic erhalten" })
    /// The user's email address
    email             String   @unique @db.VarChar(60) /// @zod.email({ message: "Invalide E-Mail-Adresse" })
    /// The user's first name
    firstname         String   @db.VarChar(20) /// @zod.min(3, { message: "Vorname zu kurz" }).max(20, { message: "Vorname zu lang" })
    /// The user's last name
    lastname          String   @db.VarChar(20) /// @zod.min(3, { message: "Nachname zu kurz" }).max(20, { message: "Nachname zu lang" })
    /// Used to lock the user out of the app, i.e. preventing any privileged access
    locked            Boolean  @default(true)
    /// Authorization/Permission for the CMS
    canAccessCMS      Boolean  @default(false)
    /// Authorization/Permission for the Lab
    canAccessLab      Boolean  @default(false)
    /// Authorization/Permission for Schoolib
    canAccessSchoolib Boolean  @default(false)
    /// (LAB) Current pizza selection
    pizza             Pizza?   @relation(fields: [pizzaUUID], references: [uuid])
    /// (LAB) The foreign key of the pizza selection this user has a relation with
    pizzaUUID         String?  @db.Uuid
    /// This timestamp is updated on every mutation automatically
    updatedAt         DateTime @default(now()) @updatedAt
    /// This timestamp is set on creation automatically
    createdAt         DateTime @default(now())
}

model Page {
    /// The unique ID of the page
    uuid         String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    /// The page's category
    category     PageCategory @relation(fields: [categoryUUID], references: [uuid])
    /// The foreign key of the category this page has a relation with
    categoryUUID String       @db.Uuid
    /// The page's title
    title        String       @db.VarChar(40) /// @zod.min(3, { message: "Titel zu kurz" }).max(40, { message: "Titel zu lang" })
    /// The page's content
    content      String       @db.Text
    /// This timestamp is updated on every mutation automatically
    updatedAt    DateTime     @default(now()) @updatedAt
    /// This timestamp is set on creation automatically
    createdAt    DateTime     @default(now())
}

model PageCategory {
    /// The unique ID of the page category
    uuid      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    /// The pages that belong to this category
    pages     Page[]
    /// The category name
    name      String   @db.VarChar(40) /// @zod.min(3, { message: "Name zu kurz" }).max(40, { message: "Name zu lang" })
    /// This timestamp is updated on every mutation automatically
    updatedAt DateTime @default(now()) @updatedAt
    /// This timestamp is set on creation automatically
    createdAt DateTime @default(now())
}

model Pizza {
    /// The unique ID of the pizza
    uuid      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    /// All users that have selected this pizza
    users     User[]
    /// The pizza name
    name      String   @unique
    /// The price of the pizza (in cents, because floating point arithmetic drives me nuts)
    price     Int      @db.SmallInt
    /// This timestamp is updated on every mutation automatically
    updatedAt DateTime @default(now()) @updatedAt
    /// This timestamp is set on creation automatically
    createdAt DateTime @default(now())
}
