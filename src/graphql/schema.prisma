// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = "file:../../db/main.db"
}

model User {
    id                  Int                  @id @default(autoincrement())
    name                String
    short               String               @unique
    password            String
    pages               PagesOnUsers[]
    permissions         PermissionsOnUsers[] @relation("UserPermissions")
    permissionsAssigned PermissionsOnUsers[] @relation("UserPermissionsAssigned")
}

model Page {
    id         Int            @id @default(autoincrement())
    title      String
    content    String
    lastEdited DateTime       @default(now())
    history    PageHistory[]
    authors    PagesOnUsers[]
    parent     Page?          @relation("PageParentChildren", fields: [parentId], references: [id])
    parentId   Int?
    children   Page[]         @relation("PageParentChildren")
}

model PageHistory {
    id         Int      @id @default(autoincrement())
    title      String
    content    String
    lastEdited DateTime @default(now())
    page       Page     @relation(fields: [pageId], references: [id])
    pageId     Int
}

model PagesOnUsers {
    assignedAt DateTime @default(now())
    user       User     @relation(fields: [userId], references: [id])
    userId     Int
    page       Page     @relation(fields: [pageId], references: [id])
    pageId     Int

    @@id([userId, pageId])
}

model Permission {
    id    Int                  @id @default(autoincrement())
    name  String
    users PermissionsOnUsers[]
}

model PermissionsOnUsers {
    assignedAt   DateTime   @default(now())
    assignedBy   User       @relation("UserPermissionsAssigned", fields: [assignedById], references: [id])
    assignedById Int
    user         User       @relation("UserPermissions", fields: [userId], references: [id])
    userId       Int
    permission   Permission @relation(fields: [permissionId], references: [id])
    permissionId Int

    @@id([userId, permissionId])
}
